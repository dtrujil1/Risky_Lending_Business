---
title: "Data Preparation & Cleaning"
output: github_document
---

```{r setup, include=F}
knitr::opts_chunk$set(
  fig.path = "markdown_figs/data_preparation-"
)
```

```{r message=F}
library(magrittr)
library(dplyr)
library(ggplot2)
```

## Loading the dataset

```{r}
train_df <- read.csv("data/train_v3.csv")
```

## Investigating The Percentage of `NA`s per Columnwise

```{r}
na_percentage <- function(df, fmt = F) {
  df %>%
    is.na() %>%
    colMeans() %>%
    sapply(function(train) {
      if (fmt) {
        return(sprintf("%.5f%%", x * 100))
      }

      train
    })
}

na_percent_df <- na_percentage(train) %>%
  data_frame(Columns = names(.), `NA %` = .) %>%
  mutate_at(
    vars(`NA %`),
    funs(round(. * 100, 2))
  ) %>%
  mutate(label = sprintf("%g%%", `NA %`)) %>%
  arrange(desc(`NA %`))

na_percent_df %>% select(-label) %>% filter(`NA %` > 10.00)
```

```{r}
na_percent_df %>% filter(`NA %` > 5.00) %>%
  filter(`NA %`> 0) %>%
  ggplot(aes(x = Columns, y = `NA %`, fill = Columns)) +
  geom_bar(stat="identity") +
  guides(fill = F) +
  coord_flip() +
  geom_text(aes(label = label), hjust = 1.6, size = 3.5) +
  theme_minimal()
```

## Investigating The Percentage of `NA`s Rowise

```{r}
train %>%
  is.na() %>%
  rowMeans() %>%
  data_frame(`NA %` = .) %>%
  group_by(`NA %`) %>%
  summarise(freq = n()) %>%
  mutate_at(
      .vars = vars(`NA %`),
      .funs = function(x) x * 100
  ) %>%
  arrange(desc(`NA %`))
```


## Investigating 0 Filled Columns

```{r}
zero_percentage <- function(train, fmt = F) {
  return ( sapply(train, function(train) {
    return(all(x == 0))
  })
  )
}
```

```{r}
zero_percent_df <- zero_percentage(train) %>%
  data_frame(Columns = names(.), `Zero %` = .) %>%
  filter(`Zero %` == T)

zero_percent_df
```

## Removing Rows that had 10% or more of its values as `NA`s

```{r}
train <- train[rowMeans(is.na(train)) <= 0.10,]

train %>%
  is.na() %>%
  rowMeans() %>%
  data_frame(`NA %` = .) %>%
  group_by(`NA %`) %>%
  summarise(freq = n()) %>%
  mutate_at(
      .vars = vars(`NA %`),
      .funs = function(x) x * 100
  ) %>%
  arrange(desc(`NA %`))
```
